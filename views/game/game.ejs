<center>
<h2>Welcome <%= req.user.username %></h2>
<div id="newMessageForm">
    <textarea id="message" placeholder="Enter your message here:"></textarea>
    <button id="postMessageButton">Add Message</button>
</div>
<div id="messagesContainer">
</div>
</center>
<script>
    var MessageModel = Backbone.Model.extend({
        urlRoot: '/messages',
    });
    
    
    var messages = new MessageCollection();
    messages.fetch();
    $("#postMessageButton").click(function(){
        var messageText = $("#message").val();
        messages.create({message: messageText}, {wait: true});
        $("#message").val("");
    });
    _.templateSettings = {
        interpolate : /\{\{(.+?)\}\}/g
    };
    var MessagesView = Backbone.View.extend({
        el: '#messagesContainer',
        initialize: function () {
            this.collection.on('add', this.render, this);
            this.render();
        },
        template: _.template("<div><p><b>{{ username }}: </b>{{ message }}</p></div>"),
        render: function () {
                this.$el.html("");
                this.collection.each(function(msg){
                    this.$el.append(this.template(msg.toJSON()));
                }, this)
        }
    });
    
</script>